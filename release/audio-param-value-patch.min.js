/*
 Fix for AudioParam.value | WebkitAudioContext-patch
 https://github.com/meszaros-lajos-gyorgy/webkitAudioContext-patch
 License: MIT
*/
!function(){"use strict";function a(a,b,c,d,e){if(a<=d)return b;if(e<=a)return c;var f=(a-d)/(e-d);return b+f*(c-b)}function b(a,b,c,d,e){if(a<=d)return b;if(e<=a)return c;if(b===c)return b;var f=(a-d)/(e-d);return 0<b&&0<c||b<0&&c<0?b*Math.pow(c/b,f):0}function c(a,b,c,d,e){return a<=d?b:c+(b-c)*Math.exp((d-a)/e)}function d(a,b,c,d){if(0===b.length)return 0;var e=(a-c)/d,f=e*(b.length-1),g=0|f,h=g+1;if(b.length<=h)return b[b.length-1];var i=b[g],j=b[h],k=f%1;return i+k*(j-i)}function e(a,b,c){return 0==a.length||c(b,a[0])<0?[void 0,0]:c(b,a[a.length-1])>0?[a.length-1,void 0]:f(a,0,a.length-1,b,c)}function f(a,b,c,d,e){if(b>c)return[c,void 0];var g=Math.floor((b+c)/2),h=a[g];return e(h,d)<0&&a[g+1]&&e(a[g+1],d)>0?[g,g+1]:e(h,d)>0?f(a,b,g-1,d,e):e(h,d)<0?f(a,g+1,c,d,e):[g]}var g=!1;try{g=navigator.userAgent.match(/Firefox\/([\d.]+)/)[1].split(".").map(function(a){return parseInt(a)})}catch(a){}if(g!==!1){AudioParam.prototype._events=[],AudioParam.prototype._ctx=null;var h=AudioParam.prototype.setValueAtTime;AudioParam.prototype.setValueAtTime=function(a,b){var c=Array.from(arguments);return null!==this._ctx&&this._insertEvent({type:"setValueAtTime",time:b,value:a,args:c}),h.apply(this,c)};var i=AudioParam.prototype.linearRampToValueAtTime;AudioParam.prototype.linearRampToValueAtTime=function(a,b){var c=Array.from(arguments);return null!==this._ctx&&this._insertEvent({type:"linearRampToValueAtTime",time:b,value:a,args:c}),i.apply(this,c)};var j=AudioParam.prototype.exponentialRampToValueAtTime;AudioParam.prototype.exponentialRampToValueAtTime=function(a,b){var c=Array.from(arguments);return null!==this._ctx&&this._insertEvent({type:"exponentialRampToValueAtTime",time:b,value:a,args:c}),j.apply(this,c)};var k=AudioParam.prototype.setTargetAtTime;AudioParam.prototype.setTargetAtTime=function(a,b,c){var d=Array.from(arguments);return null!==this._ctx&&this._insertEvent({type:"setTargetAtTime",time:b,value:a,timeConstant:c,args:d}),k.apply(this,d)};var l=AudioParam.prototype.setValueCurveAtTime;AudioParam.prototype.setValueCurveAtTime=function(a,b,c){var d=Array.from(arguments);return null!==this._ctx&&this._insertEvent({type:"setValueCurveAtTime",time:b,curve:a,duration:c,args:d}),l.apply(this,d)};var m=AudioParam.prototype.cancelScheduledValues;AudioParam.prototype.cancelScheduledValues=function(a){return null!==this._ctx&&(this._events=this._events.filter(function(b){return b.time<a})),m.apply(this,Array.from(arguments))},AudioParam.prototype._insertEvent=function(a){var e,f,b=a.time,c=this._events=JSON.parse(JSON.stringify(this._events)),d=0;if(0===c.length||c[c.length-1].time<b)c.push(a);else{for(e=0,f=c.length;e<f;e++){if(c[e].time===b&&c[e].type===a.type){d=1;break}if(b<c[e].time)break}c.splice(e,d,a)}},AudioParam.prototype._getValueAtTime=function(f){var i,j,k,l,m,g=this._events,h=this.defaultValue,n=e(g,{time:f},function(a,b){return a.time-b.time}),o=n[0],p=n[1];for(1===n.length||void 0!==o?i=o:void 0!==p&&(i=p),i=Math.max(0,i-1),j=g.length;i<j&&(k=g[i],l=g[i+1],m=Math.min(f,l?l.time:f),!(f<k.time));i++){switch(k.type){case"setValueAtTime":case"linearRampToValueAtTime":case"exponentialRampToValueAtTime":h=k.value;break;case"setTargetAtTime":h=c(m,h,k.value,k.time,k.timeConstant);break;case"setValueCurveAtTime":h=d(m,k.curve,k.time,k.duration)}if(l)switch(l.type){case"linearRampToValueAtTime":h=a(m,h,l.value,k.time,l.time);break;case"exponentialRampToValueAtTime":h=b(m,h,l.value,k.time,l.time)}}return h};var n=Object.getOwnPropertyDescriptor(AudioParam.prototype,"value"),o=n.set;n.set=function(a){console.log("set"),null===this._ctx?o.apply(this,Array.from(arguments)):this.setValueAtTime(a,this._ctx.currentTime)};var p=n.get;n.get=function(){return null===this._ctx?p.apply(this,Array.from(arguments)):this._getValueAtTime(this._ctx.currentTime)},Object.defineProperty(AudioParam.prototype,"value",n);var q=AudioContext.prototype.createGain;AudioContext.prototype.createGain=function(){var a=q.apply(this,Array.from(arguments));return a.gain._ctx=this,a};var r=AudioContext.prototype.createOscillator;AudioContext.prototype.createOscillator=function(){var a=r.apply(this,Array.from(arguments));return a.frequency._ctx=this,a.detune._ctx=this,a}}}();
